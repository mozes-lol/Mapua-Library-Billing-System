<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase Connection</title>
</head>
<body>
    <h1>Supabase Connection Test</h1>
    
    <button id="testBtn">Test Connection</button>
    <button id="testAuthBtn">Test Auth Check</button>
    <button id="testTableBtn">Test Users Table (No Auth)</button>
    
    <pre id="result"></pre>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'
        import { SUPABASE_CONFIG } from './config.js'

        const result = document.getElementById('result')
        const supabase = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey)

        document.getElementById('testBtn').addEventListener('click', async () => {
            result.textContent = 'Testing connection...\n'
            
            try {
                result.textContent += 'Supabase URL: ' + SUPABASE_CONFIG.url + '\n'
                result.textContent += 'Anon Key: ' + SUPABASE_CONFIG.anonKey.substring(0, 20) + '...\n\n'
                
                const { data, error } = await supabase.auth.getSession()
                
                if (error) {
                    result.textContent += 'ERROR: ' + error.message + '\n'
                    result.textContent += 'Error details: ' + JSON.stringify(error, null, 2)
                } else {
                    result.textContent += '✅ Connection successful!\n'
                    result.textContent += 'Session: ' + JSON.stringify(data, null, 2)
                }
            } catch (error) {
                result.textContent += '❌ Connection failed: ' + error.message + '\n'
                console.error(error)
            }
        })

        document.getElementById('testAuthBtn').addEventListener('click', async () => {
            result.textContent = 'Testing auth with credentials...\n'
            
            const testEmail = prompt('Enter email:')
            const testPassword = prompt('Enter password:')
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: testEmail,
                    password: testPassword
                })
                
                if (error) {
                    result.textContent += '❌ Auth failed\n'
                    result.textContent += 'Error: ' + error.message + '\n'
                    result.textContent += 'Status: ' + error.status + '\n'
                    result.textContent += 'Details: ' + JSON.stringify(error, null, 2)
                } else {
                    result.textContent += '✅ Auth successful!\n'
                    result.textContent += 'User: ' + JSON.stringify(data, null, 2)
                }
            } catch (error) {
                result.textContent += '❌ Error: ' + error.message + '\n'
                console.error(error)
            }
        })

        document.getElementById('testTableBtn').addEventListener('click', async () => {
            result.textContent = 'Testing users table access (no auth)...\n'
            
            try {
                const { data, error, count } = await supabase
                    .from('users')
                    .select('*', { count: 'exact' })
                    .limit(1)
                
                if (error) {
                    result.textContent += '❌ Table access failed\n'
                    result.textContent += 'Error: ' + error.message + '\n'
                    result.textContent += 'Code: ' + error.code + '\n'
                    result.textContent += 'Details: ' + JSON.stringify(error, null, 2)
                } else {
                    result.textContent += '✅ Table accessible!\n'
                    result.textContent += 'Row count: ' + count + '\n'
                    result.textContent += 'Sample data: ' + JSON.stringify(data, null, 2)
                }
            } catch (error) {
                result.textContent += '❌ Error: ' + error.message + '\n'
                console.error(error)
            }
        })
    </script>
</body>
</html>
